# Optimization Copilot — 科学家使用指南

> 一款智能优化助手，帮助科学家设计更好的实验、发现隐藏规律、通过AI驱动的贝叶斯优化加速科学研究。

---

## 目录

1. [快速入门](#1-快速入门)
2. [创建优化任务](#2-创建优化任务)
3. [工作台界面](#3-工作台界面)
4. [AI对话助手](#4-ai对话助手)
5. [洞察发现](#5-洞察发现)
6. [实验建议](#6-实验建议)
7. [诊断与监控](#7-诊断与监控)
8. [引导与人机协作](#8-引导与人机协作)
9. [多目标优化](#9-多目标优化)
10. [数据导出与可复现性](#10-数据导出与可复现性)
11. [安全与约束](#11-安全与约束)
12. [高级分析](#12-高级分析)
13. [常见问题](#13-常见问题)

---

## 1. 快速入门

### 什么是 Optimization Copilot？

Optimization Copilot 是一个 AI 驱动的实验优化平台。你上传实验数据，系统会：

- **学习** 参数与结果之间的关系
- **建议** 下一组最有价值的实验条件
- **发现** 隐藏的规律、相关性和最优区域
- **解释** 为什么某些条件表现更好
- **引导** 基于你的专家知识来调整搜索方向

### 30秒工作流程

```
上传CSV → 映射列 → 创建任务 → 与AI对话 → 运行建议实验 → 循环迭代
```

1. 打开应用 `http://localhost:5173`
2. 在仪表板点击 **"+ New Campaign"**
3. 上传包含实验数据的 CSV 文件
4. 将列映射为参数和目标
5. 点击 **"Create Campaign"** 创建任务
6. 在工作台中，与AI对话：**"Discover insights from data"**
7. 询问：**"What should I try next?"** 获取实验建议

---

## 2. 创建优化任务

### 上传数据

导航到 **New Campaign** 页面（`/new-campaign`），支持上传 CSV 格式数据。

**数据结构要求：**

| 列类型 | 说明 | 示例 |
|--------|------|------|
| **参数（Parameters）** | 你可以控制的输入变量 | 温度、压力、催化剂浓度 |
| **目标（Objectives）** | 你想优化的输出指标 | 产率、选择性、纯度 |
| **元数据（Metadata）** | 标签或标识符（可选） | 样品编号、批次号、操作员 |

### 列映射

上传后，系统自动检测列类型：

- **数值列** → 识别为连续参数或目标变量
- **文本列** → 识别为分类参数或元数据

你可以手动调整每列的角色：

| 角色 | 含义 |
|------|------|
| **连续参数** | 带最小/最大范围的数值输入（如温度 20–200°C） |
| **分类参数** | 离散选项（如溶剂：乙醇、甲醇、水） |
| **目标（最小化）** | 越小越好（如成本、误差、毒性） |
| **目标（最大化）** | 越大越好（如产率、效率、选择性） |
| **元数据** | 不参与优化，仅保留作为参考 |
| **忽略** | 从任务中完全排除 |

### 任务设置

| 设置项 | 默认值 | 说明 |
|--------|--------|------|
| **批量大小（Batch Size）** | 5 | 每轮建议的实验数量 |
| **探索权重（Exploration Weight）** | 0.5 | 0=利用已知好区域，1=探索未知区域 |

---

## 3. 工作台界面

创建任务后进入 **工作台（Workspace）**，包含 6 个标签页：

### 标签页：Overview（概览）

- **摘要卡片**：迭代次数、总试验数、最佳 KPI、当前阶段
- **收敛曲线**：目标值随迭代的变化（蓝线 = 历史最优，灰点 = 各次试验）
- **诊断卡片**：8 项关键健康指标一览
- **阶段时间线**：任务阶段的可视化历史（冷启动 → 学习 → 利用）

### 标签页：Explore（探索）

- **散点矩阵**：参数间、参数与目标间的散点图
- 直观识别数据中的聚类、趋势和异常值

### 标签页：Suggestions（建议）

- **下一组实验**：AI 生成的建议，包含预测值和不确定性
- **建议卡片**：按采集分数排序（平衡预期改进与探索）

### 标签页：Insights（洞察）

- **完整洞察面板**：所有发现的规律，按类别组织（详见[第5节](#5-洞察发现)）

### 标签页：History（历史）

- **试验表格**：所有实验的完整历史记录，包含参数、目标和状态
- 支持排序、筛选、搜索

### 标签页：Export（导出）

- 下载数据为 **CSV**、**JSON** 或 **XLSX** 格式
- 包含所有参数、目标、元数据、QC 状态和时间戳

### 对话面板

工作台右侧有一个持久对话面板。点击气泡图标打开。底部的快捷按钮可一键访问常用查询。

---

## 4. AI对话助手

对话助手理解关于你的任务的自然语言问题。以下是你可以问的内容：

### 发现洞察
> **"Discover insights from data"**（发现数据中的洞察）
> **"What patterns do you see?"**（你看到了什么规律？）
> **"Analyze my data"**（分析我的数据）

返回丰富的结构化洞察，带有颜色编码的卡片：
- **发现**（蓝色）：关于最佳条件的关键发现
- **建议**（绿色）：可操作的最优区间建议
- **警告**（橙色）：风险区域和失败模式
- **趋势**（紫色）：收敛和探索趋势

同时还有：相关性条形图、最佳条件表格、最优参数区间、参数交互作用。

### 获取建议
> **"Suggest next parameter values"**（建议下一组参数值）
> **"What should I try next?"**（我接下来该试什么？）
> **"Recommend 10 experiments"**（推荐10个实验）

返回一个排序的实验建议列表，包含参数值和预测结果。

### 查看诊断
> **"Show diagnostics"**（显示诊断信息）
> **"How is my campaign doing?"**（我的任务进展如何？）
> **"Is the optimization converging?"**（优化是否在收敛？）

返回 8 项健康指标：收敛趋势、改进速度、最佳 KPI、探索覆盖率、失败率、噪声估计、停滞长度、信噪比。

### 了解重要性
> **"Which parameter matters most?"**（哪个参数最重要？）
> **"Show parameter importance"**（显示参数重要性）
> **"What drives the objective?"**（什么驱动了目标？）

返回基于 fANOVA 的每个参数的重要性评分。

### 获取解释
> **"Why did you recommend this?"**（为什么推荐这个？）
> **"Why is it stuck?"**（为什么停滞了？）
> **"Explain the current phase"**（解释当前阶段）

提供人类可读的优化状态解释和推理依据。

### 引导说明
> **"Focus on specific region"**（聚焦特定区域）
> **"How do I steer the search?"**（如何引导搜索？）

指导你如何使用引导指令来聚焦或避开特定参数区域。

### 导出帮助
> **"Export results"**（导出结果）
> **"How do I download my data?"**（如何下载我的数据？）

提供可用的导出格式和访问方式。

---

## 5. 洞察发现

洞察引擎对你的数据执行 7 种分析：

### 5.1 最优实验条件

识别最佳实验及其共同特征。

**输出示例：**
```
最佳目标值: -0.3402
最优结果的共性: ni_load ≈ 0.633
```

### 5.2 参数-目标相关性

计算每个参数与每个目标之间的 Pearson 相关系数。

| 参数 | 相关系数 | 强度 | 方向 |
|------|---------|------|------|
| ni_load | +0.408 | 中等 | 正相关 |
| mn_load | -0.235 | 弱 | 负相关 |

**解读：** 正相关表示增加该参数倾向于改善目标；负相关表示相反。

### 5.3 参数交互作用

检测参数对之间的协同和拮抗效应。

**示例：**
```
ni_load × fe_load: 协同交互作用 (r=0.445)
```
这意味着同时调节 ni_load 和 fe_load 的效果比单独调节任一参数更强。

### 5.4 最优参数区间

识别目标表现最好的参数范围。

**示例：**
```
mn_load: 最优区间 [0, 0.6]（总范围 [0, 1]）→ 提升 6.8%
```
这意味着 mn_load 在 0 到 0.6 之间的实验平均结果好 6.8%。

### 5.5 失败模式

识别失败率偏高的参数范围。

**示例：**
```
温度 > 180°C: 失败率 35%（总体 8%）
```

### 5.6 趋势检测

监控优化过程中的动态变化：

- **收敛性**：优化是否在收敛？
- **方差缩减**：结果是否越来越一致？
- **探索收窄**：搜索是否在集中到有希望的区域？
- **加速度**：最近的迭代是否比早期改进更快？

### 5.7 自然语言摘要

将所有洞察综合为优先级排序的、人类可读的陈述，包含重要性评分和类别（发现/警告/建议/趋势）。

---

## 6. 实验建议

### 建议是如何生成的

系统使用**贝叶斯优化（Bayesian Optimization）**来建议实验：

1. **代理模型**：一个统计模型（高斯过程或随机森林）从你的数据中学习参数与目标之间的关系
2. **采集函数**：平衡利用（在已知好的区域附近尝试）与探索（在未知区域尝试）
3. **排序**：候选实验按采集分数排序
4. **多样性**：批量建议经过多样化处理以避免冗余

### 可用优化算法

| 算法 | 适用场景 | 说明 |
|------|---------|------|
| **高斯过程 BO** | 中小数据集，连续参数 | 贝叶斯优化的黄金标准 |
| **随机森林 BO** | 混合参数类型，噪声数据 | 对噪声和分类变量鲁棒 |
| **TPE** | 高维问题 | 树结构 Parzen 估计器 |
| **TuRBO** | 局部优化，利用阶段 | 信赖域贝叶斯优化 |
| **CMA-ES** | 连续参数，无梯度 | 进化策略 |
| **NSGA-II** | 多目标优化 | 非支配排序遗传算法 |
| **拉丁超立方** | 初始空间填充 | 分层随机采样 |
| **Sobol** | 初始空间填充 | 准随机低差异序列 |

系统会根据数据特征（参数数量、参数类型、噪声水平、数据集大小）**自动选择**最佳算法。

### 调整探索与利用

- **探索权重 = 0**：完全集中在已知好的区域（利用）
- **探索权重 = 0.5**：均衡（默认值）
- **探索权重 = 1**：集中在未探索的区域（探索）

---

## 7. 诊断与监控

### 任务阶段

你的任务会自动经历以下阶段：

| 阶段 | 说明 | 系统行为 |
|------|------|---------|
| **冷启动（Cold Start）** | 数据不足 | 空间填充采样（LHS/Sobol） |
| **学习（Learning）** | 构建代理模型 | 平衡探索的主动学习 |
| **利用（Exploitation）** | 收敛到最优区域 | 在最优区域附近聚焦搜索 |
| **停滞（Stagnation）** | 近期无改进 | 可能触发策略切换或探索增强 |
| **终止（Termination）** | 任务完成 | 最终结果可用 |

### 诊断指标

| 指标 | 含义 | 理想值 |
|------|------|--------|
| **收敛趋势** | 每次迭代的改进速率 | > 0（持续改进） |
| **改进速度** | 近期改进速度 | > 0 |
| **最佳 KPI** | 已发现的最佳目标值 | 取决于具体问题 |
| **探索覆盖率** | 已探索的参数空间比例 | 30–80% |
| **失败率** | 失败实验的比例 | < 20% |
| **噪声估计** | 测量噪声水平 | 越低越好 |
| **停滞长度** | 无改进的连续迭代数 | < 20 属正常 |
| **信噪比** | 信号强度与噪声的比值 | > 3 为佳 |

---

## 8. 引导与人机协作

### 引导优化方向

你可以基于领域专业知识引导搜索：

**聚焦区域** — 让优化器集中在特定参数范围：
```json
{
  "action": "focus_region",
  "region_bounds": {
    "temperature": [150, 200],
    "pressure": [1.0, 3.0]
  },
  "reason": "文献表明这个范围最有潜力"
}
```

**避开区域** — 排除不安全或无效的参数范围：
```json
{
  "action": "avoid_region",
  "region_bounds": {
    "temperature": [250, 300]
  },
  "reason": "设备无法安全运行超过250°C"
}
```

### 注入专家先验

你可以将领域知识注入为先验信念：

- **软约束**：偏好特定参数范围，但不完全排除
- **区域聚焦**：将探索权重倾向已知的有潜力区域
- **参数关系**：编码已知的依赖关系

### 渐进式自主权

系统支持分级自主水平：

| 级别 | 人类角色 | AI 角色 |
|------|---------|---------|
| **手动** | 人类决定所有实验 | AI 仅提供分析 |
| **监督** | AI 建议，人类逐批审批 | AI 生成建议 |
| **协作** | AI 决策，人类可否决 | AI 带监督运行 |
| **自主** | 人类仅监控 | AI 完全自主运行 |

当 AI 建议持续带来好结果时，信任度自动提升。

---

## 9. 多目标优化

对于有多个目标的问题（如同时最大化产率和最小化成本）：

### Pareto 前沿

系统追踪 **Pareto 前沿** — 一组解，其中任何目标的改进都必须以牺牲另一个目标为代价。

### 交互式探索

- **加权查询**：为每个目标指定重要性权重
- **期望水平**：为每个目标设定目标值
- **理想点**：找到最接近你理想值的解
- **权衡分析**：理解目标之间的权衡斜率

### 多目标问题（>3个目标）

对于超过 3 个目标的问题，系统使用：
- **超体积指标（Hypervolume）**：Pareto 前沿的质量度量
- **IGD 指标**：逆广义距离
- **超体积贡献排序**：当大多数点都是非支配时的区分性排序

---

## 10. 数据导出与可复现性

### 导出格式

| 格式 | 内容 | 使用场景 |
|------|------|---------|
| **CSV** | 参数、目标、元数据、时间戳 | 表格分析 |
| **JSON** | 带模式的完整任务结构 | 程序化访问 |
| **XLSX** | Excel 兼容的表格数据 | 与同事分享 |

### 审计追踪

每个决策都用加密哈希链记录：
- 任务创建、参数变更
- 每批建议及使用的算法
- 每次提交的观测结果
- 策略切换和阶段转换
- 引导指令

### 可复现性

- **确定性执行**：给定相同的种子和数据，系统产生完全相同的建议
- **任务重播**：重新执行已记录的任务以验证可复现性
- **FAIR 元数据**：生成可查找、可访问、可互操作、可复用的数据集元数据

---

## 11. 安全与约束

### 定义安全操作范围

对于每个参数，你可以定义安全限制：

| 危险等级 | 含义 |
|---------|------|
| **绿色** | 安全 — 正常操作范围 |
| **黄色** | 注意 — 接近限制 |
| **红色** | 危险 — 超出安全范围 |

### 安全类别

系统支持与实验室工作相关的危险类别：
- 热、压力、毒性、可燃性
- 腐蚀、反应性、电气、机械

### 应急协议

如果建议的实验接近不安全区域：

1. **警告**：提醒用户，继续监控
2. **暂停**：暂停建议直到人工审查
3. **回退**：回退到已知安全的参数区域
4. **停止**：立即终止任务

---

## 12. 高级分析

### 通过分析 API 可用：

| 分析方法 | 说明 | 使用时机 |
|---------|------|---------|
| **fANOVA** | 基于功能方差分析的特征重要性 | 识别哪些参数最重要 |
| **相关性分析** | Pearson 相关系数 | 快速检查关系 |
| **异常值检测** | N-sigma 统计异常值识别 | 质量控制 |
| **符号回归** | 自动发现控制方程 | 寻找数学关系 |
| **Pareto 分析** | 多目标前沿计算 | 多目标问题 |
| **因果发现** | 从数据中学习因果结构 | 理解因果关系 |
| **干预分析** | 模拟参数干预 | "如果我改变X会怎样？" |
| **反事实推理** | "如果当时......会怎样？" | 回顾性分析 |
| **物理约束GP** | 带物理约束的代理模型 | 领域知识建模 |
| **假设生成** | 自动生成科学假设 | 发现 |
| **假设检验** | 统计验证假设 | 验证 |
| **Bootstrap 置信区间** | 通过自助法计算置信区间 | 不确定性量化 |
| **鲁棒性检验** | 你的结论有多稳健？ | 敏感性分析 |

---

## 13. 常见问题

### 我需要多少数据才能开始？

- **最低要求**：3 个观测值（但建议将是探索性的）
- **良好**：10–20 个观测值（代理模型开始学习）
- **很好**：50+ 个观测值（可靠的重要性和交互检测）

### 如果我有分类参数怎么办？

完全支持。系统内部使用独热编码，并选择能处理混合参数类型的算法（如随机森林 BO、TPE）。

### 我可以向现有任务添加新数据吗？

可以。通过对话提交新试验结果（"I have new results"）或通过 API 提交。模型会增量更新。

### 如果某些实验失败了怎么办？

失败的实验也是有价值的！系统从失败中学习，映射不安全或无效的区域，并在未来的建议中避开它们。

### 我可以比较多个任务吗？

可以。使用**比较页面**（`/compare`）并排比较任务。选择 2 个以上任务来查看哪个取得了更好的结果。

### 如何知道何时停止？

关注这些信号：
- **停滞长度** > 30 次迭代 → 优化可能已经收敛
- **收敛趋势** ≈ 0 → 预期不会有更多改进
- **改进速度** ≈ 0 → 收益递减

对话助手也会提醒你："Optimization is converging — improvement rate has slowed significantly."（优化正在收敛——改进速度已明显放缓。）

### 我的数据安全吗？

- 所有数据存储在你的本地服务器上
- 加密审计追踪防止篡改
- 不向外部服务发送数据（除了AI对话使用配置的 LLM API）

---

*Optimization Copilot — 通过智能实验设计加速科学发现。*
